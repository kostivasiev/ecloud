### Update Firewall Policy with sync in progress
PATCH https://{{host}}/{{version}}/firewall-policies/{{policy_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Update Firewall Policy with sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
%}

### Update Firewall Rule with Policy sync in progress
PATCH https://{{host}}/{{version}}/firewall-rules/{{rule_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Update Firewall Rule with sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
%}

### Update Firewall Rule including ports with Policy sync in progress
PATCH https://{{host}}/{{version}}/firewall-rules/{{rule_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

{
    "ports": [
        {
            "protocol": "TCP",
            "source": "111",
            "destination": "222"
        }
    ]
}

> {%
client.test('Update Firewall Rule including ports with Policy sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
%}

### Check Ports have not changed
GET https://{{host}}/{{version}}/firewall-rules/{{rule_id}}/ports
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Check no modifications to ports', function () {
    client.assert(response.status === 200, '200 response not received');
    client.assert(response.body.data[0].source === 333, 'Source not the same as original');
    client.assert(response.body.data[0].destination === 444, 'Destination not the same as original');
});
%}

### Update Firewall Port with Policy sync in progress
PATCH https://{{host}}/{{version}}/firewall-rule-ports/{{port_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Update Firewall Port with Policy sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
%}

### Delete Policy with Sync in progress
DELETE https://{{host}}/{{version}}/firewall-policies/{{policy_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Delete Policy with Sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
%}

### Delete Firewall Rule with Policy sync in progress
DELETE https://{{host}}/{{version}}/firewall-rules/{{rule_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Update Firewall Rule with sync in progress', function () {
    client.assert(response.status === 409, '409 status not received');
});
client.log('Run the following SQL query to return to a completed sync status:-');
client.log('UPDATE `syncs` SET completed=1 WHERE resource_id=\'' + client.global.get('policy_id') + '\';');
%}