### Get last instance created
GET https://{{host}}/{{version}}/instances?per_page=1&sort=created_at:desc
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.global.set('instance_id', response.body.data[0].id);
%}

### Create an Image for it
POST https://{{host}}/{{version}}/instances/{{instance_id}}/create-image
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

{
    "name": "Test Image"
}

> {%
client.test('Image Created', function () {
    client.assert(response.status === 202, '202 response not received');
});
client.global.set('image_id', response.body.data.id);
%}

### Verify image directly via Kingpin
GET https://compute-20.ecloud-service.ukfast.co.uk:8443/api/v2/vpc/{{dev_vpc_id}}/template/{{image_id}}
Authorization: Basic a2luZ3BpbmFwaTp0S20/Yzc/T3Yhb2Y=
Content-Type:  application/json

> {%
client.test('Image Verified', function () {
    client.assert(response.status === 200, '200 response not received');
});
%}

### Delete image on Kingpin
DELETE https://compute-20.ecloud-service.ukfast.co.uk:8443/api/v2/vpc/{{dev_vpc_id}}/template/{{image_id}}
Authorization: Basic a2luZ3BpbmFwaTp0S20/Yzc/T3Yhb2Y=
Content-Type:  application/json

> {%
client.test('Image Deleted', function () {
    client.assert(response.status === 200, '200 response not received');
});
%}

### Cleanup image in DB
DELETE https://{{host}}/{{version}}/images/{{image_id}}
X-consumer-custom-id:  0-0
X-consumer-groups:  ecloud.read, ecloud.write
Content-Type:  application/json

> {%
client.test('Image Deleted', function () {
    client.assert(response.status === 202, '202 response not received');
});
%}